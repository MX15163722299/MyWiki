## 确定线程数的 3 种常用方式

------

### ✅ 方式一：**参考生产数据（最推荐）**

- 从日志、APM、Nginx 日志、Prometheus、业务监控中获取：
  - 高峰期访问量
  - 并发用户数（比如同时下单的人数）
  - 接口 QPS（每秒多少请求）

**公式估算：**

```
text


复制编辑
线程数 ≈ QPS × 平均响应时间（秒）
```

例如：

- 接口 QPS = 1000
- 接口响应时间 = 0.5 秒

则需要线程数 ≈ 1000 × 0.5 = **500**

------

### ✅ 方式二：**逐步升压，观察拐点**

1. 初始设置：如 50 个线程
2. 每次增加 50~100 个线程（或按倍数增长）
3. 监控系统：
   - TPS 是否线性增长
   - 响应时间是否暴涨
   - 错误率是否上升

当发现：

- TPS 无法提升
- 响应时间明显上升
- 系统开始报错（500、timeout）

**👉 就说明线程数已达系统上限**

------

### ✅ 方式三：**按业务场景还原并发**

举例：

- 某商城有 10 万注册用户
- 高峰期 5% 用户活跃，约 5000 用户在线
- 其中 10% 在秒杀商品，即 500 人抢购

那你压测秒杀接口时，就可以模拟：

- 线程数 500
- ramp-up 时间 10s 内完成（模拟突刺）





